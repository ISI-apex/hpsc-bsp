From d8010d3e75ec7194a4703774090b27486b742d48 Mon Sep 17 00:00:00 2001
From: Alan Modra <amodra@gmail.com>
Date: Sun, 24 Sep 2017 14:36:48 +0930
Subject: [PATCH] PR22186, divide-by-zero in decode_line_info

	PR 22186
	* dwarf2.c (decode_line_info): Fail on lh.line_range of zero
	rather than dividing by zero.

Upstream-Status: Backport
Affects: <= 2.29.1
CVE: CVE-2017-15025
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 bfd/ChangeLog | 6 ++++++
 bfd/dwarf2.c  | 2 ++
 2 files changed, 8 insertions(+)

Index: git/bfd/dwarf2.c
===================================================================
--- git.orig/bfd/dwarf2.c
+++ git/bfd/dwarf2.c
@@ -2432,6 +2432,8 @@ decode_line_info (struct comp_unit *unit
 	    case DW_LNS_set_basic_block:
 	      break;
 	    case DW_LNS_const_add_pc:
+	      if (lh.line_range == 0)
+		goto line_fail;
 	      if (lh.maximum_ops_per_insn == 1)
 		address += (lh.minimum_instruction_length
 			    * ((255 - lh.opcode_base) / lh.line_range));
Index: git/bfd/ChangeLog
===================================================================
--- git.orig/bfd/ChangeLog
+++ git/bfd/ChangeLog
@@ -1,3 +1,10 @@
+2017-09-24  Alan Modra  <amodra@gmail.com>
+
+       PR 22186
+       * dwarf2.c (decode_line_info): Fail on lh.line_range of zero
+       rather than dividing by zero.
+
+
 2017-09-25  Alan Modra  <amodra@gmail.com>
 
        PR 22200
